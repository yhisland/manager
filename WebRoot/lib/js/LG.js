(function(e){window.LG={},window._lg_subwin_width=800,window._lg_subwin_height=400,LG.cookies=function(){var e=function(){};return e.prototype.get=function(e){var t="",n=e+"=";return document.cookie.length>0&&(offset=document.cookie.indexOf(n),offset!=-1&&(offset+=n.length,end=document.cookie.indexOf(";",offset),end==-1&&(end=document.cookie.length),t=decodeURIComponent(document.cookie.substring(offset,end)))),t},e.prototype.set=function(e,t,n){var r="",i=1;n!=null&&(i=n),r=new Date((new Date).getTime()+i*864e5),r="; expires="+r.toGMTString(),document.cookie=e+"="+encodeURIComponent(t)+";path=/"+r},e.prototype.remvoe=function(e){var t="";t=new Date((new Date).getTime()-1),t="; expires="+t.toGMTString(),document.cookie=e+"="+escape("")+";path=/"+t},new e}(),LG.tip=function(t){LG.wintip?(LG.wintip.set("content",t),LG.wintip.show()):LG.wintip=e.ligerDialog.tip({content:t}),setTimeout(function(){LG.wintip.hide()},4e3)},LG.prevLoadImage=function(t,n){for(var r in n)e("<img />").attr("src",t+n[r])},LG.showLoading=function(t){t=t||"正在加载中...",e("body").append("<div class='jloading'>"+t+"</div>"),e.ligerui.win.mask()},LG.hideLoading=function(t){e("body > div.jloading").remove(),e.ligerui.win.unmask({id:(new Date).getTime()})},LG.showSuccess=function(t,n){if(typeof t=="function"||arguments.length==0)n=t,t="操作成功!";e.ligerDialog.success(t,"提示信息",n)},LG.showError=function(t,n){if(typeof t=="function"||arguments.length==0)n=t,t="操作失败!";e.ligerDialog.error(t,"提示信息",n)},LG.prevDialogImage=function(e){e=e||"",LG.prevLoadImage(e+"lib/ligerUI/skins/Aqua/images/win/",["dialog-icons.gif"]),LG.prevLoadImage(e+"lib/ligerUI/skins/Gray/images/win/",["dialogicon.gif"])},LG.ajax=function(t){var n=t||{},r=t.ashxUrl||"../",i=n.url||r+e.param({type:n.type,method:n.method}).replace("type=","").replace("method=","").replace("&","/");e.ajax({cache:!1,async:!0,url:i,data:n.data,dataType:"json",type:"post",beforeSend:function(){LG.loading=!0,n.beforeSend?n.beforeSend():LG.showLoading(n.loading)},complete:function(){LG.loading=!1,n.complete?n.complete():LG.hideLoading()},success:function(e){n.success&&n.success(e)},error:function(e,t){LG.tip("发现系统错误 <BR>错误码："+e.status)}})},LG.getPageMenuNo=function(){var t=e("#MenuNo").val()||e("#MenuNo").attr("value");return!t&&getQueryStringByName&&(t=getQueryStringByName("MenuNo")),t},LG.createButton=function(t){var n=e.extend({appendTo:e("body")},t||{}),r=e('<div class="button button2 buttonnoicon" style="width:60px"><div class="button-l"> </div><div class="button-r"> </div> <span></span></div>');n.icon&&(r.removeClass("buttonnoicon"),r.append('<div class="button-icon"> <img src="../'+n.icon+'" /> </div> ')),n.green&&r.removeClass("button2"),n.width&&r.width(n.width),n.click&&r.click(n.click),n.text&&e("span",r).html(n.text),typeof n.appendTo=="string"&&(n.appendTo=e(n.appendTo)),r.appendTo(n.appendTo)},LG.bulidFilterGroup=function(t){if(!t)return null;var n={op:"and",rules:[]};return e(":input",t).not(":submit, :reset, :image,:button, [disabled]").each(function(){if(!this.name)return;if(!e(this).hasClass("field"))return;if(e(this).val()==null||e(this).val()=="")return;var t=e(this).attr("ltype"),r=e(this).attr("op")||"like",i=e(this).attr("vt")||"string",s=e(this).val(),o=this.name;t=="select"&&(s=e.ligerui.get(o).getValue(),o=o),n.rules.push({op:r,field:o,value:s,type:i})}),n},LG.appendSearchButtons=function(t,n){if(!t)return;t=e(t);var r=e('<ul><li style="margin-right:8px;clear:left;"></li><li></li></ul><div class="l-clear"></div>').appendTo(t);LG.addSearchButtons(t,n,r.find("li:eq(0)"),r.find("li:eq(1)"))},LG.appendSearchBtn=function(t,n){if(!t)return;t=e(t);var r=e('<ul><li style="margin-right:8px;clear:left;"></li></ul><div class="l-clear"></div>').appendTo(t);LG.createButton({appendTo:r.find("li:eq(0)"),text:"搜索",click:n})},LG.addSearchButtons=function(e,t,n,r){if(!e)return;n&&LG.createButton({appendTo:n,text:"搜索",click:function(){var n=LG.bulidFilterGroup(e);n.rules.length?t.set("parms",{where:JSON2.stringify(n)}):t.set("parms",{}),t.loadData()}}),r&&LG.createButton({appendTo:r,width:80,text:"高级搜索",click:function(){t.showFilter()}})},LG.setFormDefaultBtn=function(e,t){var n=[];e&&n.push({text:"取消",onclick:e}),t&&n.push({text:"保存",onclick:t}),LG.addFormButtons(n)},LG.addFormButtons=function(t){if(!t)return;var n=e("body > div.form-bar");n.length==0&&(n=e('<div class="form-bar"><div class="form-bar-inner"></div></div>').appendTo("body")),t instanceof Array||(t=[t]),e(t).each(function(t,r){var i=e('<div class="l-dialog-btn"><div class="l-dialog-btn-l"></div><div class="l-dialog-btn-r"></div><div class="l-dialog-btn-inner"></div></div> ');e("div.l-dialog-btn-inner:first",i).html(r.text||"BUTTON"),r.onclick&&i.bind("click",function(){r.onclick(r)}),r.width&&i.width(r.width),e("> div:first",n).append(i)})},LG.loadForm=function(t,n,r){n=n||{},t||(t=e("form:first"));var i=e.extend({beforeSend:function(){LG.showLoading("正在加载表单数据中...")},complete:function(){LG.hideLoading()},success:function(n){for(var i in n){var s=e("[name="+i+"]",t);s.is(":checkbox,:radio")?s[0].checked=n[i]?!0:!1:s.val(n[i])}var o=e.ligerui.find(e.ligerui.controls.Input);for(var u=0,a=o.length;u<a;u++){var f=o[u];f.updateStyle(),o[u]instanceof e.ligerui.controls.TextBox&&f.checkValue()}r&&r(n)},error:function(e){LG.showError("数据加载失败!<BR>错误信息："+e)}},n);LG.ajax(i)},LG.setFormReadOnly=function(t){t||(t=e("form:first")),e("input,select,textarea",t).attr("readonly","readonly");var n=e.ligerui.find(e.ligerui.controls.Input);for(var r=0,i=n.length;r<i;r++){var s=n[r];s.set("readonly",!0)}},LG.submitForm=function(t,n,r){function i(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i.name==t)return!0}return!1}t||(t=e("form:first")),t.valid()?t.ajaxSubmit({dataType:"html",success:n,beforeSubmit:function(t,n,r){e(":checkbox,:radio",n).each(function(){i(t,this.name)||t.push({name:this.name,type:this.type,value:this.checked})});for(var s=0,o=t.length;s<o;s++){var u=t[s];if(u.type=="checkbox"||u.type=="radio")u.value=e("[name="+u.name+"]",n)[0].checked?"true":"false"}},beforeSend:function(e,t,n){LG.showLoading("正在保存数据中...")},complete:function(){LG.hideLoading()},error:function(e){LG.tip("发现系统错误 <BR>错误码："+e.status)}}):LG.showInvalid()},LG.showInvalid=function(t){t=t||LG.validator;if(!t)return;var n='<div class="invalid">存在'+t.errorList.length+"个字段验证不通过，请检查!</div>";e.ligerDialog.error(n)},LG.validate=function(t,n){return typeof t=="string"?t=e(t):typeof t=="object"&&t.NodeType==1&&(t=e(t)),n=e.extend({errorPlacement:function(t,n){n.attr("id")||n.attr("id",(new Date).getTime()),n.hasClass("l-textarea")?n.addClass("l-textarea-invalid"):n.hasClass("l-text-field")&&n.parent().addClass("l-text-invalid"),e(n).removeAttr("title").ligerHideTip(),e(n).attr("title",t.html()).ligerTip({distanceX:5,distanceY:-3,auto:!0})},success:function(t){if(!t.attr("for"))return;var n=e("#"+t.attr("for"));n.hasClass("l-textarea")?n.removeClass("l-textarea-invalid"):n.hasClass("l-text-field")&&n.parent().removeClass("l-text-invalid"),e(n).removeAttr("title").ligerHideTip()}},n||{}),LG.validator=t.validate(n),LG.validator},LG.loadToolbar=function(e,t){LG.loadButtons({loading:"正在加载工具条中...",callback:function(n){if(!e.toolbarManager)return;if(!n||!n.length)return;var r=[];for(var i=0,s=n.length;i<s;i++){var o=n[i];r[r.length]={click:t,text:o.BTNNAME,img:rootPath+o.BTNICON,id:o.BTNNO},r[r.length]={line:!0}}e.toolbarManager.set("items",r)}})},LG.loadButtons=function(t){var n=e.extend({menuno:LG.getPageMenuNo(),loading:"正在加载按钮中...",callback:function(){}},t||{});LG.ajax({loading:"正在加载工具条中...",type:"button",method:"getUserButtons",data:{MenuNo:n.menuno},success:function(e){n.callback(e)}})},LG.closeCurrentTab=function(t){t||(t=e("#framecenter > .l-tab-content > .l-tab-content-item:visible").attr("tabid")),tab&&tab.removeTabItem(t)},LG.closeAndReloadParent=function(t,n){LG.closeCurrentTab(t);var r=e("#mainmenu ul.menulist li[menuno="+n+"]"),i=r.attr("tabid"),s=window.frames[i];tab&&tab.selectTabItem(i),s&&s.f_reload?s.f_reload():tab&&tab.reload(i)},LG.closeCurrentDetailPage=function(e){parent&&parent.homepage?parent.LG.closeCurrentTab(null):parent?(e&&parent.f_reload&&parent.f_reload(),parent.LG.closeDetailPage()):window.close()},LG.closeDetailPage=function(){window.detailWin&&window.detailWin.close()},LG.showChildPage=LG.showDetailPage=function(e,t,n,r,i){top.f_addTab&&!i?top.f_addTab(e,t,n+"/"+r):LG.openSubWindow({url:r,title:t})},LG.openSubWindow=function(t){var n=e.extend(!0,{width:_lg_subwin_width,height:_lg_subwin_height,isResize:!0,isDrag:!0,title:"明细页"},t);window.detailWin=e.ligerDialog.open(n)},LG.overrideGridLoading=function(){e.extend(e.ligerDefaults.Grid,{onloading:function(){LG.showLoading("正在加载表格数据中...")},onloaded:function(){LG.hideLoading()}})},LG.adujestConfig=function(t,n){if(t.Form&&t.Form.fields)for(var r=t.Form.fields.length-1;r>=0;r--){var i=t.Form.fields[r];e.inArray(i.name,n)!=-1&&t.Form.fields.splice(r,1)}if(t.Grid&&t.Grid.columns)for(var r=t.Grid.columns.length-1;r>=0;r--){var s=t.Grid.columns[r];e.inArray(s.name,n)!=-1&&t.Grid.columns.splice(r,1)}if(t.Search&&t.Search.fields)for(var r=t.Search.fields.length-1;r>=0;r--){var i=t.Search.fields[r];e.inArray(i.name,n)!=-1&&t.Search.fields.splice(r,1)}},LG.findToolbarItem=function(e,t){if(!e.toolbarManager)return null;if(!e.toolbarManager.options.items)return null;var n=e.toolbarManager.options.items;for(var r=0,i=n.length;r<i;r++)if(n[r].id==t)return n[r];return null},LG.setGridDoubleClick=function(e,t,n){n=n||toolbarBtnItemClick;if(!n)return;e.bind("dblClickRow",function(r){var i=LG.findToolbarItem(e,t);if(!i)return;e.select(r),n(i)})},LG.FormToJSON=function(e){var t={};for(var n,r=0;r<e.length;r++){n=e[r];var i=n.name,s=LG.encodeSpecialCode(n.value.trim());if(i.indexOf(".")<0){t[i]=s;continue}var o=i.split("."),u=t;for(var a=0;a<o.length-1;a++){var f=o[a];if(f.indexOf("[")<0)u[f]==null&&(u[f]={}),u=u[f];else{var l=f.split("["),c=l[0],h=parseInt(l[1]);u[c]==null&&(u[c]=[]),u=u[c],multiChooseArray=t[c],u[h]==null&&(u[h]={}),u=u[h]}}if(u[o[o.length-1]]){var p=u[o[o.length-1]];u[o[o.length-1]]=p}else u[o[o.length-1]]=s}return t},LG.encodeSpecialCode=function(e){return e=e.replace(/\%/g,"%25"),e=e.replace(/\#/g,"%23"),e=e.replace(/\&/g,"%26"),e}})(jQuery)